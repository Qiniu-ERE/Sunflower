# v2.0 更新说明

> **发布日期**: 2025-10-24  
> **版本**: v2.0  
> **主要更新**: 视频分辨率优化 + AI自动字幕生成

---

## 📋 更新概览

v2.0 版本带来了两个重要功能更新：

1. **视频分辨率优化**: 默认输出从 1080p 改为 720p，优化文件大小和处理速度
2. **AI自动字幕**: 集成 OpenAI Whisper，支持从音频自动生成字幕并嵌入视频

---

## ✨ 新增功能

### 1. 自动字幕生成

使用 OpenAI Whisper 语音识别模型，自动从音频生成字幕：

**主要特性**:
- ✅ 支持中文、英文等多种语言
- ✅ 生成 SRT 和 ASS 字幕格式
- ✅ 可自定义字体、颜色、大小、位置
- ✅ 自动嵌入到视频中
- ✅ 可选功能，需要时可禁用

**使用方法**:
```python
from services.video.video_exporter import VideoExportConfig

# 启用字幕（默认）
config = VideoExportConfig(
    enable_subtitles=True
)

# 禁用字幕
config = VideoExportConfig(
    enable_subtitles=False
)
```

**详细文档**: [字幕功能文档](./字幕功能文档.md)

### 2. 视频分辨率优化

**默认分辨率**: 从 1920x1080 (1080p) 改为 1280x720 (720p)

**优势**:
- 文件大小减少约 40%
- 处理速度提升约 30%
- 仍然保持良好的观看体验
- 适合在线分享和移动设备观看

**配置**:
```python
from services.video.video_exporter import VideoExportConfig

# 使用默认 720p
config = VideoExportConfig()

# 或明确指定 1080p
config = VideoExportConfig(
    resolution="1920x1080",
    video_bitrate="5000k"
)
```

---

## 🔧 技术更新

### 新增模块

1. **字幕服务** (`src/services/subtitle/subtitle_service.py`)
   - `SubtitleService`: 字幕生成和处理
   - `SubtitleConfig`: 字幕配置管理
   - `SubtitleSegment`: 字幕片段数据结构

### 更新模块

1. **视频导出器** (`src/services/video/video_exporter.py`)
   - 添加字幕生成支持
   - 集成字幕嵌入功能
   - 更新默认配置参数

### 依赖更新

新增依赖（在 `requirements.txt` 中）:
```
openai-whisper>=20231117
```

---

## 📊 性能对比

### 文件大小对比

以 10 分钟演讲视频为例：

| 配置 | 文件大小 | 减少比例 |
|------|---------|---------|
| 1080p (v1.x) | ~75MB | - |
| 720p (v2.0) | ~45MB | 40% ↓ |
| 720p + 字幕 | ~48MB | 36% ↓ |

### 处理时间对比

| 步骤 | v1.x (1080p) | v2.0 (720p) | 提升 |
|------|-------------|------------|-----|
| 视频片段生成 | ~2分钟 | ~1.5分钟 | 25% ↑ |
| 视频合成 | ~30秒 | ~20秒 | 33% ↑ |
| 字幕生成 | N/A | ~2分钟 | 新功能 |
| 字幕嵌入 | N/A | ~1分钟 | 新功能 |
| **总计** | ~2.5分钟 | ~4.5分钟 | - |

**注意**: 虽然加入字幕功能后总时间增加，但字幕是可选的。如果禁用字幕，720p 导出比 1080p 快约 30%。

---

## 🚀 升级指南

### 从 v1.x 升级到 v2.0

#### 1. 安装新依赖

```bash
# 更新依赖
pip install -r requirements.txt

# 或单独安装 Whisper
pip install openai-whisper
```

#### 2. 更新代码（可选）

如果您在代码中明确指定了分辨率，可能需要更新：

```python
# v1.x 代码
config = VideoExportConfig(
    resolution="1920x1080"
)

# v2.0 推荐（使用默认 720p）
config = VideoExportConfig()

# 或保持 1080p
config = VideoExportConfig(
    resolution="1920x1080",
    video_bitrate="5000k"
)
```

#### 3. 测试字幕功能

```bash
# 运行字幕测试
python src/services/subtitle/subtitle_service.py examples/fixtures/audio.mp3
```

### 兼容性说明

- ✅ **向后兼容**: v2.0 完全兼容 v1.x 的代码
- ✅ **配置兼容**: 旧的配置文件仍然有效
- ✅ **可选功能**: 字幕功能是可选的，不影响现有功能

---

## 📝 配置变更

### VideoExportConfig 新增参数

```python
@dataclass
class VideoExportConfig:
    resolution: str = "1280x720"      # 改变: 从 "1920x1080"
    video_bitrate: str = "3000k"      # 改变: 从 "5000k"
    enable_subtitles: bool = True     # 新增
    subtitle_style: str = "default"   # 新增
```

### 默认值变更

| 参数 | v1.x | v2.0 | 说明 |
|------|------|------|------|
| resolution | 1920x1080 | 1280x720 | 降低分辨率 |
| video_bitrate | 5000k | 3000k | 匹配新分辨率 |
| enable_subtitles | N/A | True | 新增字幕功能 |

---

## 🐛 已知问题

### 字幕相关

1. **首次使用下载模型**
   - 问题: 首次使用 Whisper 需要下载模型文件（~100MB）
   - 解决: 确保网络连接稳定，或使用 VPN

2. **中文识别准确度**
   - 问题: base 模型对部分方言识别不够准确
   - 解决: 使用 medium 或 large 模型提高准确度

3. **处理时间较长**
   - 问题: 大模型处理速度慢
   - 解决: 使用 GPU 加速或选择较小的模型

### 视频导出

1. **字幕显示问题**
   - 问题: 部分播放器可能不显示嵌入字幕
   - 解决: 使用 VLC、MPC-HC 等标准播放器

---

## 📚 相关文档

- [视频导出模块文档](./视频导出模块文档.md)
- [字幕功能文档](./字幕功能文档.md)
- [MVP实现文档](./MVP_实现文档.md)

---

## 🎯 未来计划

### v2.1 (计划中)

- [ ] 支持更多字幕样式预设
- [ ] 字幕时间轴编辑器
- [ ] 批量处理优化
- [ ] 支持外挂字幕文件

### v2.2 (计划中)

- [ ] 实时字幕预览
- [ ] 字幕翻译功能
- [ ] 多语言字幕支持
- [ ] 字幕位置智能调整

---

## 💡 最佳实践

### 1. 选择合适的分辨率

- **在线分享**: 推荐 720p（默认）
- **高质量归档**: 使用 1080p
- **移动设备**: 使用 720p 或更低

### 2. 字幕配置建议

- **日常使用**: base 模型（默认）
- **高质量要求**: small 或 medium 模型
- **快速预览**: tiny 模型

### 3. 性能优化

- **启用 GPU**: 大幅提升字幕生成速度
- **并行处理**: 使用多核CPU加速视频片段生成
- **分段处理**: 超长视频建议分段处理

---

## 🙏 致谢

感谢以下开源项目：

- [OpenAI Whisper](https://github.com/openai/whisper) - 语音识别模型
- [FFmpeg](https://ffmpeg.org/) - 视频处理工具

---

## 📞 反馈与支持

如有问题或建议，请通过以下方式联系：

- GitHub Issues: [提交问题](https://github.com/your-org/lecture-video-composer/issues)
- Email: support@example.com
- 文档: [完整文档](../README.md)

---

**v2.0 - 让演讲视频更智能** 🎬✨
