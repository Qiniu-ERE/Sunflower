# å¤šå¹³å°éƒ¨ç½²æŒ‡å—

> é’ˆå¯¹ä¸åŒæ“ä½œç³»ç»Ÿçš„è¯¦ç»†éƒ¨ç½²è¯´æ˜

---

## ğŸ“‹ ç›®å½•

- [Windows éƒ¨ç½²](#windows-éƒ¨ç½²)
- [macOS éƒ¨ç½²](#macos-éƒ¨ç½²)
- [Linux éƒ¨ç½²](#linux-éƒ¨ç½²)
- [Docker è·¨å¹³å°éƒ¨ç½²](#docker-è·¨å¹³å°éƒ¨ç½²)
- [å¹³å°å·®å¼‚å¯¹ç…§](#å¹³å°å·®å¼‚å¯¹ç…§)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## Windows éƒ¨ç½²

### ğŸ“¦ ç³»ç»Ÿè¦æ±‚

**æœ€ä½é…ç½®**ï¼š
```
æ“ä½œç³»ç»Ÿ: Windows 10 (64ä½) æˆ–æ›´é«˜
Python:   3.8 æˆ–æ›´é«˜
å†…å­˜:     4GB
ç¡¬ç›˜:     10GB å¯ç”¨ç©ºé—´
```

**æ¨èé…ç½®**ï¼š
```
æ“ä½œç³»ç»Ÿ: Windows 11 (64ä½)
Python:   3.10 æˆ–æ›´é«˜
å†…å­˜:     8GB æˆ–æ›´é«˜
ç¡¬ç›˜:     50GB SSD
```

### ğŸ”§ ç¯å¢ƒå‡†å¤‡

#### 1. å®‰è£… Python

**æ–¹æ³• 1ï¼šä½¿ç”¨å®˜æ–¹å®‰è£…åŒ…**

```powershell
# ä¸‹è½½ Python 3.10+
# è®¿é—®ï¼šhttps://www.python.org/downloads/windows/

# å®‰è£…æ—¶å‹¾é€‰ï¼š
â˜‘ï¸ Add Python to PATH
â˜‘ï¸ Install pip
â˜‘ï¸ Install for all users
```

**éªŒè¯å®‰è£…**ï¼š
```powershell
python --version
pip --version
```

**æ–¹æ³• 2ï¼šä½¿ç”¨ Chocolatey**

```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell
Set-ExecutionPolicy Bypass -Scope Process -Force
iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))

# å®‰è£… Python
choco install python310 -y
```

#### 2. å®‰è£… FFmpeg

**æ–¹æ³• 1ï¼šæ‰‹åŠ¨å®‰è£…**

```powershell
# 1. ä¸‹è½½ FFmpeg
# è®¿é—®ï¼šhttps://www.gyan.dev/ffmpeg/builds/

# 2. è§£å‹åˆ° C:\ffmpeg

# 3. æ·»åŠ åˆ°ç¯å¢ƒå˜é‡
$env:Path += ";C:\ffmpeg\bin"
[Environment]::SetEnvironmentVariable("Path", $env:Path, "Machine")

# 4. éªŒè¯
ffmpeg -version
```

**æ–¹æ³• 2ï¼šä½¿ç”¨ Chocolatey**

```powershell
choco install ffmpeg -y
```

#### 3. å®‰è£… Git

```powershell
# ä½¿ç”¨ Chocolatey
choco install git -y

# æˆ–ä¸‹è½½å®‰è£…åŒ…
# https://git-scm.com/download/win
```

### ğŸš€ é¡¹ç›®éƒ¨ç½²

#### 1. å…‹éš†é¡¹ç›®

```powershell
# ä½¿ç”¨ Git Bash æˆ– PowerShell
cd C:\Users\YourName\Projects
git clone https://github.com/Qiniu-ERE/Sunflower.git
cd Sunflower\lecture-video-composer
```

#### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```powershell
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\Activate.ps1

# å¦‚æœæ‰§è¡Œç­–ç•¥é™åˆ¶ï¼Œè¿è¡Œï¼š
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

#### 3. é…ç½®pipåŠ é€Ÿï¼ˆå¯é€‰ï¼‰

```powershell
# å›½å†…æœåŠ¡å™¨æ¨èä½¿ç”¨æ¸…åå¤§å­¦é•œåƒæºåŠ é€Ÿ
# åˆ›å»º pip é…ç½®ç›®å½•
mkdir $env:APPDATA\pip

# åˆ›å»ºé…ç½®æ–‡ä»¶
@"
[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
"@ | Out-File -FilePath $env:APPDATA\pip\pip.ini -Encoding utf8
```

#### 4. å®‰è£…ä¾èµ–

```powershell
# å‡çº§ pip
python -m pip install --upgrade pip

# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt

# å¦‚æœå®‰è£…å¤±è´¥ï¼Œå°è¯•ï¼š
pip install -r requirements.txt --use-pep517
```

#### 5. é…ç½®ç¯å¢ƒ

```powershell
# å¤åˆ¶é…ç½®æ–‡ä»¶
Copy-Item .env.example .env

# ç¼–è¾‘é…ç½®ï¼ˆä½¿ç”¨è®°äº‹æœ¬æˆ– VSCodeï¼‰
notepad .env
```

#### 6. å¯åŠ¨æœåŠ¡

```powershell
# å¼€å‘æ¨¡å¼
python run_web.py

# ç”Ÿäº§æ¨¡å¼
$env:FLASK_ENV="production"
python run_web.py
```

### ğŸ”¥ Windows é˜²ç«å¢™é…ç½®

```powershell
# å…è®¸ Python é€šè¿‡é˜²ç«å¢™
New-NetFirewallRule -DisplayName "Python Web Server" `
  -Direction Inbound `
  -Program "C:\Path\To\Python\python.exe" `
  -Action Allow

# æˆ–å…è®¸ç«¯å£ 5000
New-NetFirewallRule -DisplayName "Port 5000" `
  -Direction Inbound `
  -LocalPort 5000 `
  -Protocol TCP `
  -Action Allow
```

### ğŸ“ Windows æœåŠ¡é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

#### ä½¿ç”¨ NSSM

```powershell
# ä¸‹è½½ NSSM
# https://nssm.cc/download

# å®‰è£…æœåŠ¡
nssm install LectureVideoComposer "C:\Path\To\Python\python.exe"
nssm set LectureVideoComposer AppDirectory "C:\Path\To\Project"
nssm set LectureVideoComposer AppParameters "run_web.py"

# å¯åŠ¨æœåŠ¡
nssm start LectureVideoComposer

# æŸ¥çœ‹çŠ¶æ€
nssm status LectureVideoComposer
```

#### ä½¿ç”¨ä»»åŠ¡è®¡åˆ’ç¨‹åº

```powershell
# åˆ›å»ºå¯åŠ¨è„šæœ¬ start.bat
@echo off
cd C:\Path\To\Project
call venv\Scripts\activate.bat
python run_web.py
```

**é…ç½®ä»»åŠ¡**ï¼š
1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº"
2. åˆ›å»ºåŸºæœ¬ä»»åŠ¡
3. è§¦å‘å™¨ï¼šç³»ç»Ÿå¯åŠ¨æ—¶
4. æ“ä½œï¼šå¯åŠ¨ç¨‹åº `C:\Path\To\start.bat`

---

## macOS éƒ¨ç½²

### ğŸ“¦ ç³»ç»Ÿè¦æ±‚

**æ”¯æŒç‰ˆæœ¬**ï¼š
```
macOS Big Sur (11.0) æˆ–æ›´é«˜
macOS Monterey (12.0) æ¨è
macOS Ventura (13.0) æœ€ä½³
```

### ğŸ”§ ç¯å¢ƒå‡†å¤‡

#### 1. å®‰è£… Homebrew

```bash
# å®‰è£… Homebrew
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# éªŒè¯å®‰è£…
brew --version
```

#### 2. å®‰è£… Python

```bash
# ä½¿ç”¨ Homebrew å®‰è£…
brew install python@3.10

# æ·»åŠ åˆ° PATHï¼ˆå¦‚æœéœ€è¦ï¼‰
echo 'export PATH="/usr/local/opt/python@3.10/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc

# éªŒè¯
python3 --version
pip3 --version
```

#### 3. å®‰è£… FFmpeg

```bash
# ä½¿ç”¨ Homebrew
brew install ffmpeg

# éªŒè¯
ffmpeg -version
```

#### 4. å®‰è£… Git

```bash
# macOS é€šå¸¸è‡ªå¸¦ gitï¼Œå¦‚æœæ²¡æœ‰ï¼š
brew install git
```

### ğŸš€ é¡¹ç›®éƒ¨ç½²

#### 1. å…‹éš†é¡¹ç›®

```bash
cd ~/Projects
git clone https://github.com/Qiniu-ERE/Sunflower.git
cd Sunflower/lecture-video-composer
```

#### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# éªŒè¯
which python
# åº”è¯¥æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒè·¯å¾„
```

#### 3. é…ç½®pipåŠ é€Ÿï¼ˆå¯é€‰ï¼‰

```bash
# å›½å†…æœåŠ¡å™¨æ¨èä½¿ç”¨æ¸…åå¤§å­¦é•œåƒæºåŠ é€Ÿ
mkdir -p ~/.pip
echo -e "[global]\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple" > ~/.pip/pip.conf
```

#### 4. å®‰è£…ä¾èµ–

```bash
# å‡çº§ pip
pip install --upgrade pip

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# M1/M2 èŠ¯ç‰‡ç‰¹æ®Šå¤„ç†
# å¦‚æœé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼š
arch -arm64 pip install -r requirements.txt
```

#### 5. é…ç½®ç¯å¢ƒ

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®
nano .env
# æˆ–ä½¿ç”¨ VSCode
code .env
```

#### 6. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼
python run_web.py

# ç”Ÿäº§æ¨¡å¼
export FLASK_ENV=production
python run_web.py
```

### ğŸ”¥ macOS é˜²ç«å¢™é…ç½®

```bash
# å…è®¸å…¥ç«™è¿æ¥ï¼ˆå›¾å½¢ç•Œé¢ï¼‰
# ç³»ç»Ÿåå¥½è®¾ç½® > å®‰å…¨æ€§ä¸éšç§ > é˜²ç«å¢™ > é˜²ç«å¢™é€‰é¡¹
# æ·»åŠ  Python åˆ°å…è®¸åˆ—è¡¨

# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/local/bin/python3
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --unblockapp /usr/local/bin/python3
```

### ğŸ“ macOS æœåŠ¡é…ç½®ï¼ˆLaunchAgentï¼‰

#### åˆ›å»ºæœåŠ¡æ–‡ä»¶

```bash
# åˆ›å»º plist æ–‡ä»¶
nano ~/Library/LaunchAgents/com.lecture.video.composer.plist
```

**é…ç½®å†…å®¹**ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.lecture.video.composer</string>
    
    <key>ProgramArguments</key>
    <array>
        <string>/Users/YourName/Projects/Sunflower/lecture-video-composer/venv/bin/python</string>
        <string>/Users/YourName/Projects/Sunflower/lecture-video-composer/run_web.py</string>
    </array>
    
    <key>WorkingDirectory</key>
    <string>/Users/YourName/Projects/Sunflower/lecture-video-composer</string>
    
    <key>RunAtLoad</key>
    <true/>
    
    <key>KeepAlive</key>
    <true/>
    
    <key>StandardOutPath</key>
    <string>/Users/YourName/Projects/Sunflower/lecture-video-composer/logs/stdout.log</string>
    
    <key>StandardErrorPath</key>
    <string>/Users/YourName/Projects/Sunflower/lecture-video-composer/logs/stderr.log</string>
</dict>
</plist>
```

**åŠ è½½æœåŠ¡**ï¼š

```bash
# åŠ è½½æœåŠ¡
launchctl load ~/Library/LaunchAgents/com.lecture.video.composer.plist

# å¯åŠ¨æœåŠ¡
launchctl start com.lecture.video.composer

# æŸ¥çœ‹çŠ¶æ€
launchctl list | grep lecture

# åœæ­¢æœåŠ¡
launchctl stop com.lecture.video.composer

# å¸è½½æœåŠ¡
launchctl unload ~/Library/LaunchAgents/com.lecture.video.composer.plist
```

---

## Linux éƒ¨ç½²

### ğŸ“¦ Ubuntu/Debian

#### ç³»ç»Ÿè¦æ±‚

```
Ubuntu 20.04 LTS æˆ–æ›´é«˜
Ubuntu 22.04 LTS æ¨è
Debian 11 æˆ–æ›´é«˜
```

#### ç¯å¢ƒå‡†å¤‡

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…å¿…è¦è½¯ä»¶
sudo apt install -y \
    python3 \
    python3-pip \
    python3-venv \
    git \
    ffmpeg \
    build-essential \
    libssl-dev \
    libffi-dev \
    python3-dev

# éªŒè¯å®‰è£…
python3 --version
pip3 --version
ffmpeg -version
```

#### é¡¹ç›®éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
cd /opt
sudo git clone https://github.com/Qiniu-ERE/Sunflower.git
sudo chown -R $USER:$USER Sunflower
cd Sunflower/lecture-video-composer

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# 3. é…ç½®pipåŠ é€Ÿï¼ˆå›½å†…æœåŠ¡å™¨æ¨èï¼‰
mkdir -p ~/.pip
echo -e "[global]\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple" > ~/.pip/pip.conf

# 4. å®‰è£…ä¾èµ–
pip install --upgrade pip
pip install -r requirements.txt

# 4. é…ç½®
cp .env.example .env
nano .env

# 5. å¯åŠ¨
python run_web.py
```

#### Systemd æœåŠ¡é…ç½®

```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
sudo nano /etc/systemd/system/lecture-video-composer.service
```

**æœåŠ¡é…ç½®**ï¼š

```ini
[Unit]
Description=Lecture Video Composer Service
After=network.target

[Service]
Type=simple
User=www-data
Group=www-data
WorkingDirectory=/opt/Sunflower/lecture-video-composer
Environment="PATH=/opt/Sunflower/lecture-video-composer/venv/bin"
Environment="FLASK_ENV=production"
ExecStart=/opt/Sunflower/lecture-video-composer/venv/bin/python run_web.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**å¯åŠ¨æœåŠ¡**ï¼š

```bash
# é‡æ–°åŠ è½½é…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start lecture-video-composer

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable lecture-video-composer

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status lecture-video-composer

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u lecture-video-composer -f
```

### ğŸ“¦ CentOS/RHEL

#### ç¯å¢ƒå‡†å¤‡

```bash
# CentOS 8 / RHEL 8
sudo dnf update -y
sudo dnf install -y \
    python3 \
    python3-pip \
    python3-devel \
    git \
    gcc \
    make \
    openssl-devel

# å®‰è£… FFmpegï¼ˆéœ€è¦ EPELï¼‰
sudo dnf install -y epel-release
sudo dnf install -y ffmpeg

# CentOS 7 / RHEL 7
sudo yum update -y
sudo yum install -y \
    python3 \
    python3-pip \
    python3-devel \
    git \
    gcc \
    make

# FFmpeg éœ€è¦é¢å¤–ä»“åº“
sudo yum install -y epel-release
sudo rpm -v --import http://li.nux.ro/download/nux/RPM-GPG-KEY-nux.ro
sudo rpm -Uvh http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpm
sudo yum install -y ffmpeg
```

#### é¡¹ç›®éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
cd /opt
sudo git clone https://github.com/Qiniu-ERE/Sunflower.git
sudo chown -R $USER:$USER Sunflower
cd Sunflower/lecture-video-composer

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# 3. é…ç½®pipåŠ é€Ÿï¼ˆå›½å†…æœåŠ¡å™¨æ¨èï¼‰
mkdir -p ~/.pip
echo -e "[global]\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple" > ~/.pip/pip.conf

# 4. å®‰è£…ä¾èµ–
pip install --upgrade pip
pip install -r requirements.txt

# 5. é…ç½®
cp .env.example .env
nano .env

# 6. å¯åŠ¨
python run_web.py
```

### ğŸ“¦ openEuler

#### ç³»ç»Ÿè¦æ±‚

```
openEuler 20.03 LTS æˆ–æ›´é«˜
openEuler 22.03 LTS æ¨è
```

#### ç¯å¢ƒå‡†å¤‡

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo dnf update -y

# å®‰è£…åŸºç¡€ä¾èµ–
sudo dnf install -y \
    python3 \
    python3-pip \
    python3-devel \
    git \
    gcc \
    gcc-c++ \
    make \
    openssl-devel \
    libffi-devel

# å®‰è£… FFmpeg
sudo dnf install -y ffmpeg

# éªŒè¯å®‰è£…
python3 --version
pip3 --version
ffmpeg -version
```

#### é¡¹ç›®éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
cd /opt
sudo git clone https://github.com/Qiniu-ERE/Sunflower.git
sudo chown -R $USER:$USER Sunflower
cd Sunflower/lecture-video-composer

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# 3. é…ç½®pipåŠ é€Ÿï¼ˆå›½å†…æœåŠ¡å™¨æ¨èï¼‰
mkdir -p ~/.pip
echo -e "[global]\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple" > ~/.pip/pip.conf

# 4. å®‰è£…ä¾èµ–
pip install --upgrade pip
pip install -r requirements.txt

# 5. é…ç½®
cp .env.example .env
nano .env

# 6. å¯åŠ¨
python run_web.py
```

#### Systemd æœåŠ¡é…ç½®

```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
sudo nano /etc/systemd/system/lecture-video-composer.service
```

**æœåŠ¡é…ç½®**ï¼ˆä¸å…¶ä»–Linuxå‘è¡Œç‰ˆç›¸åŒï¼‰ï¼š

```ini
[Unit]
Description=Lecture Video Composer Service
After=network.target

[Service]
Type=simple
User=www-data
Group=www-data
WorkingDirectory=/opt/Sunflower/lecture-video-composer
Environment="PATH=/opt/Sunflower/lecture-video-composer/venv/bin"
Environment="FLASK_ENV=production"
ExecStart=/opt/Sunflower/lecture-video-composer/venv/bin/python run_web.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**å¯åŠ¨æœåŠ¡**ï¼š

```bash
# é‡æ–°åŠ è½½é…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start lecture-video-composer

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable lecture-video-composer

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status lecture-video-composer

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u lecture-video-composer -f
```

#### é˜²ç«å¢™é…ç½®

```bash
# openEuler é»˜è®¤ä½¿ç”¨ firewalld
sudo firewall-cmd --permanent --add-port=5000/tcp
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --reload

# æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£
sudo firewall-cmd --list-ports
```

#### SELinux é…ç½®

```bash
# æ£€æŸ¥ SELinux çŠ¶æ€
getenforce

# ä¸´æ—¶ç¦ç”¨ï¼ˆæµ‹è¯•ç”¨ï¼‰
sudo setenforce 0

# æ°¸ä¹…é…ç½®
sudo nano /etc/selinux/config
# è®¾ç½®ï¼šSELINUX=permissive

# æˆ–é…ç½® SELinux ç­–ç•¥
sudo setsebool -P httpd_can_network_connect 1
sudo semanage port -a -t http_port_t -p tcp 5000

# æ¢å¤æ–‡ä»¶ä¸Šä¸‹æ–‡
sudo restorecon -R /opt/Sunflower
```

---

## Docker è·¨å¹³å°éƒ¨ç½²

### ğŸ³ Docker å®‰è£…

#### Windows

```powershell
# ä¸‹è½½ Docker Desktop for Windows
# https://www.docker.com/products/docker-desktop

# æˆ–ä½¿ç”¨ Chocolatey
choco install docker-desktop -y

# å¯åŠ¨ Docker Desktop å¹¶éªŒè¯
docker --version
docker-compose --version
```

#### macOS

```bash
# ä¸‹è½½ Docker Desktop for Mac
# https://www.docker.com/products/docker-desktop

# æˆ–ä½¿ç”¨ Homebrew
brew install --cask docker

# å¯åŠ¨ Docker.app å¹¶éªŒè¯
docker --version
docker-compose --version
```

#### Linux

```bash
# Ubuntu/Debian
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
newgrp docker

# CentOS/RHEL
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install -y docker-ce docker-ce-cli containerd.io
sudo systemctl start docker
sudo systemctl enable docker

# å®‰è£… Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### ğŸ“¦ ä½¿ç”¨ Docker éƒ¨ç½²

#### 1. æ„å»ºé•œåƒ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Qiniu-ERE/Sunflower.git
cd Sunflower/lecture-video-composer

# æ„å»ºé•œåƒ
docker build -t lecture-video-composer:latest .

# æŸ¥çœ‹é•œåƒ
docker images | grep lecture
```

#### 2. è¿è¡Œå®¹å™¨

```bash
# ç®€å•è¿è¡Œ
docker run -d \
  --name lecture-composer \
  -p 5000:5000 \
  -v $(pwd)/data:/app/data \
  lecture-video-composer:latest

# å¸¦ç¯å¢ƒå˜é‡
docker run -d \
  --name lecture-composer \
  -p 5000:5000 \
  -e FLASK_ENV=production \
  -e MAX_UPLOAD_SIZE=500 \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/logs:/app/logs \
  lecture-video-composer:latest

# æŸ¥çœ‹æ—¥å¿—
docker logs -f lecture-composer

# åœæ­¢å®¹å™¨
docker stop lecture-composer

# é‡å¯å®¹å™¨
docker restart lecture-composer
```

#### 3. ä½¿ç”¨ Docker Compose

**åˆ›å»º `docker-compose.yml`**ï¼š

```yaml
version: '3.8'

services:
  app:
    build: .
    container_name: lecture-composer
    ports:
      - "5000:5000"
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    environment:
      - FLASK_ENV=production
      - MAX_UPLOAD_SIZE=500
      - ALLOWED_EXTENSIONS=jpg,jpeg,png,mp3,wav
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  nginx:
    image: nginx:alpine
    container_name: lecture-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/nginx/ssl:ro
    depends_on:
      - app
    restart: unless-stopped
```

**å¯åŠ¨æœåŠ¡**ï¼š

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build
```

### ğŸ”§ Dockerfile ç¤ºä¾‹

```dockerfile
FROM python:3.10-slim

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    ffmpeg \
    git \
    && rm -rf /var/lib/apt/lists/*

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£… Python ä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# åˆ›å»ºæ•°æ®ç›®å½•
RUN mkdir -p data/uploads data/projects data/exports logs

# æš´éœ²ç«¯å£
EXPOSE 5000

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=10s --retries=3 \
  CMD python -c "import urllib.request; urllib.request.urlopen('http://localhost:5000/api/health')"

# å¯åŠ¨å‘½ä»¤
CMD ["python", "run_web.py"]
```

---

## å¹³å°å·®å¼‚å¯¹ç…§

### ğŸ“Š å‘½ä»¤å¯¹ç…§è¡¨

| åŠŸèƒ½ | Windows | macOS | Linux |
|------|---------|-------|-------|
| **Python å‘½ä»¤** | `python` | `python3` | `python3` |
| **Pip å‘½ä»¤** | `pip` | `pip3` | `pip3` |
| **æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ** | `.\venv\Scripts\Activate.ps1` | `source venv/bin/activate` | `source venv/bin/activate` |
| **æŸ¥çœ‹è¿›ç¨‹** | `tasklist` | `ps aux` | `ps aux` |
| **ç»“æŸè¿›ç¨‹** | `taskkill /PID <pid>` | `kill <pid>` | `kill <pid>` |
| **æŸ¥çœ‹ç«¯å£** | `netstat -ano` | `lsof -i :5000` | `netstat -tulpn` |
| **ç¯å¢ƒå˜é‡** | `$env:VAR="value"` | `export VAR=value` | `export VAR=value` |
| **æ–‡ä»¶æƒé™** | `icacls` | `chmod` | `chmod` |
| **æœåŠ¡ç®¡ç†** | `sc.exe` / NSSM | `launchctl` | `systemctl` |

### ğŸ“ è·¯å¾„å¯¹ç…§è¡¨

| ç±»å‹ | Windows | macOS | Linux |
|------|---------|-------|-------|
| **é¡¹ç›®è·¯å¾„** | `C:\Users\Name\Projects` | `/Users/Name/Projects` | `/opt` æˆ– `/home/user` |
| **Python è·¯å¾„** | `C:\Python310\python.exe` | `/usr/local/bin/python3` | `/usr/bin/python3` |
| **è™šæ‹Ÿç¯å¢ƒ** | `venv\Scripts` | `venv/bin` | `venv/bin` |
| **æ—¥å¿—è·¯å¾„** | `C:\ProgramData\Logs` | `/var/log` æˆ– `~/Library/Logs` | `/var/log` |
| **é…ç½®è·¯å¾„** | `%APPDATA%` | `~/Library/Application Support` | `/etc` æˆ– `~/.config` |
| **ä¸´æ—¶æ–‡ä»¶** | `%TEMP%` | `/tmp` | `/tmp` |

### ğŸ”§ é…ç½®æ–‡ä»¶å¯¹ç…§

| åŠŸèƒ½ | Windows | macOS | Linux |
|------|---------|-------|-------|
| **æœåŠ¡é…ç½®** | `*.xml` (NSSM) | `*.plist` (LaunchAgent) | `*.service` (Systemd) |
| **ç¯å¢ƒå˜é‡** | ç³»ç»Ÿå±æ€§ | `~/.zshrc` / `~/.bash_profile` | `~/.bashrc` / `/etc/environment` |
| **é˜²ç«å¢™** | Windows Defender | ç³»ç»Ÿåå¥½è®¾ç½® | `ufw` / `firewalld` |
| **Web æœåŠ¡å™¨** | IIS / Apache | Apache / Nginx | Apache / Nginx |

### âš™ï¸ æœåŠ¡ç®¡ç†å¯¹ç…§

| æ“ä½œ | Windows (NSSM) | macOS (LaunchAgent) | Linux (Systemd) |
|------|----------------|---------------------|-----------------|
| **å®‰è£…æœåŠ¡** | `nssm install <name>` | `launchctl load <plist>` | `systemctl enable <service>` |
| **å¯åŠ¨æœåŠ¡** | `nssm start <name>` | `launchctl start <label>` | `systemctl start <service>` |
| **åœæ­¢æœåŠ¡** | `nssm stop <name>` | `launchctl stop <label>` | `systemctl stop <service>` |
| **é‡å¯æœåŠ¡** | `nssm restart <name>` | `launchctl stop + start` | `systemctl restart <service>` |
| **æŸ¥çœ‹çŠ¶æ€** | `nssm status <name>` | `launchctl list` | `systemctl status <service>` |
| **æŸ¥çœ‹æ—¥å¿—** | æ—¥å¿—æ–‡ä»¶ | `~/Library/Logs` | `journalctl -u <service>` |

---

## æ•…éšœæ’æŸ¥

### ğŸ” Windows å¸¸è§é—®é¢˜

#### 1. PowerShell æ‰§è¡Œç­–ç•¥é™åˆ¶

**é—®é¢˜**ï¼šæ— æ³•è¿è¡Œ `.ps1` è„šæœ¬

**è§£å†³**ï¼š
```powershell
# æŸ¥çœ‹å½“å‰ç­–ç•¥
Get-ExecutionPolicy

# ä¸´æ—¶å…è®¸
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process

# æ°¸ä¹…å…è®¸ï¼ˆéœ€è¦ç®¡ç†å‘˜ï¼‰
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

#### 2. Python æœªæ·»åŠ åˆ° PATH

**é—®é¢˜**ï¼šå‘½ä»¤è¡Œæ— æ³•è¯†åˆ« `python` å‘½ä»¤

**è§£å†³**ï¼š
```powershell
# æ‰‹åŠ¨æ·»åŠ åˆ° PATH
$env:Path += ";C:\Python310;C:\Python310\Scripts"

# æ°¸ä¹…æ·»åŠ ï¼ˆç³»ç»Ÿç¯å¢ƒå˜é‡ï¼‰
[Environment]::SetEnvironmentVariable("Path", $env:Path + ";C:\Python310;C:\Python310\Scripts", "Machine")
```

#### 3. FFmpeg æœªæ‰¾åˆ°

**é—®é¢˜**ï¼š`ffmpeg: command not found`

**è§£å†³**ï¼š
```powershell
# ä¸‹è½½å¹¶è§£å‹ FFmpeg
# æ·»åŠ åˆ° PATH
$env:Path += ";C:\ffmpeg\bin"
[Environment]::SetEnvironmentVariable("Path", $env:Path, "Machine")
```

#### 4. ç«¯å£è¢«å ç”¨

**é—®é¢˜**ï¼š`Address already in use: 5000`

**è§£å†³**ï¼š
```powershell
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :5000

# ç»“æŸè¿›ç¨‹
taskkill /PID <PID> /F

# æˆ–æ›´æ”¹åº”ç”¨ç«¯å£
$env:FLASK_PORT=5001
python run_web.py
```

### ğŸ” macOS å¸¸è§é—®é¢˜

#### 1. Homebrew å®‰è£…å¤±è´¥

**é—®é¢˜**ï¼šå®‰è£… Homebrew æ—¶ç½‘ç»œé”™è¯¯

**è§£å†³**ï¼š
```bash
# ä½¿ç”¨å›½å†…é•œåƒ
export HOMEBREW_BREW_GIT_REMOTE="https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git"
/bin/bash -c "$(curl -fsSL https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install.sh)"
```

#### 2. Python ç‰ˆæœ¬å†²çª

**é—®é¢˜**ï¼šç³»ç»Ÿè‡ªå¸¦ Python 2.7

**è§£å†³**ï¼š
```bash
# ä½¿ç”¨ python3
python3 --version

# åˆ›å»ºåˆ«å
echo 'alias python=python3' >> ~/.zshrc
echo 'alias pip=pip3' >> ~/.zshrc
source ~/.zshrc
```

#### 3. M1/M2 èŠ¯ç‰‡å…¼å®¹æ€§

**é—®é¢˜**ï¼šæŸäº›åŒ…æ— æ³•å®‰è£…

**è§£å†³**ï¼š
```bash
# ä½¿ç”¨ Rosetta
arch -x86_64 pip install <package>

# æˆ–æŒ‡å®šæ¶æ„
arch -arm64 pip install <package>

# å®‰è£… Rosettaï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
softwareupdate --install-rosetta
```

#### 4. æƒé™é—®é¢˜

**é—®é¢˜**ï¼š`Permission denied`

**è§£å†³**ï¼š
```bash
# ä¿®æ”¹æ–‡ä»¶æƒé™
chmod +x run_web.py

# ä¿®æ”¹ç›®å½•æƒé™
sudo chown -R $USER:staff ~/Projects/Sunflower

# LaunchAgent æƒé™
chmod 644 ~/Library/LaunchAgents/com.lecture.video.composer.plist
```

### ğŸ” Linux å¸¸è§é—®é¢˜

#### 1. Git å…‹éš†å¤±è´¥

**é—®é¢˜**ï¼š`fatal: unable to access 'https://github.com/.../': HTTP/2 stream 1 was not closed cleanly`

**è§£å†³**ï¼š
```bash
# æ–¹æ³•1ï¼šç¦ç”¨ HTTP/2
git config --global http.version HTTP/1.1
git clone https://github.com/Qiniu-ERE/Sunflower.git

# æ–¹æ³•2ï¼šå¢åŠ ç¼“å†²åŒº
git config --global http.postBuffer 524288000

# æ–¹æ³•3ï¼šä½¿ç”¨ SSHï¼ˆå¦‚æœæœ‰å¯†é’¥ï¼‰
git clone git@github.com:Qiniu-ERE/Sunflower.git

# æ–¹æ³•4ï¼šä½¿ç”¨ä»£ç†ï¼ˆå¦‚æœæœ‰ï¼‰
git config --global http.proxy http://proxy.example.com:8080

# æ–¹æ³•5ï¼šé‡è¯•å‡ æ¬¡
# ç½‘ç»œä¸ç¨³å®šæ—¶å¤šå°è¯•å‡ æ¬¡é€šå¸¸èƒ½æˆåŠŸ
```

#### 2. ä¾èµ–å®‰è£…å¤±è´¥

**é—®é¢˜**ï¼šç¼–è¯‘é”™è¯¯æˆ–ç¼ºå°‘åº“

**è§£å†³**ï¼š
```bash
# Ubuntu/Debian
sudo apt install -y build-essential python3-dev libssl-dev libffi-dev

# CentOS/RHEL/openEuler
sudo yum groupinstall -y "Development Tools"
sudo yum install -y python3-devel openssl-devel libffi-devel

# æˆ–åœ¨ openEuler ä¸Šä½¿ç”¨ dnf
sudo dnf groupinstall -y "Development Tools"
sudo dnf install -y python3-devel openssl-devel libffi-devel
```

#### 2. FFmpeg ç‰ˆæœ¬è¿‡æ—§

**é—®é¢˜**ï¼šFFmpeg åŠŸèƒ½ä¸æ”¯æŒ

**è§£å†³**ï¼š
```bash
# æ·»åŠ  PPAï¼ˆUbuntuï¼‰
sudo add-apt-repository ppa:jonathonf/ffmpeg-4
sudo apt update
sudo apt install ffmpeg

# æˆ–ä»æºç ç¼–è¯‘
# https://trac.ffmpeg.org/wiki/CompilationGuide
```

#### 3. SELinux é˜»æ­¢

**é—®é¢˜**ï¼šæœåŠ¡æ— æ³•å¯åŠ¨æˆ–è®¿é—®æ–‡ä»¶

**è§£å†³**ï¼š
```bash
# æŸ¥çœ‹ SELinux æ—¥å¿—
sudo ausearch -m avc -ts recent

# ä¸´æ—¶ç¦ç”¨
sudo setenforce 0

# ç”Ÿæˆç­–ç•¥
sudo audit2allow -a -M mylectureapp
sudo semodule -i mylectureapp.pp

# æˆ–è®¾ç½®ä¸º permissive
sudo semanage permissive -a httpd_t
```

#### 4. Systemd æœåŠ¡å¤±è´¥

**é—®é¢˜**ï¼šæœåŠ¡æ— æ³•å¯åŠ¨

**è§£å†³**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u lecture-video-composer -n 50 --no-pager

# æ£€æŸ¥æœåŠ¡é…ç½®
sudo systemctl cat lecture-video-composer

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl daemon-reload

# æ£€æŸ¥è¯­æ³•
sudo systemd-analyze verify /etc/systemd/system/lecture-video-composer.service
```

### ğŸ” Docker å¸¸è§é—®é¢˜

#### 1. Docker Desktop æ— æ³•å¯åŠ¨ï¼ˆWindows/macOSï¼‰

**é—®é¢˜**ï¼šDocker Desktop å¯åŠ¨å¤±è´¥

**è§£å†³**ï¼š
```bash
# Windowsï¼šç¡®ä¿ WSL2 å·²å®‰è£…
wsl --install
wsl --set-default-version 2

# macOSï¼šé‡ç½® Docker
rm -rf ~/Library/Group\ Containers/group.com.docker
rm -rf ~/Library/Containers/com.docker.docker
# é‡æ–°å®‰è£… Docker Desktop
```

#### 2. å®¹å™¨å†…æƒé™é—®é¢˜

**é—®é¢˜**ï¼šæ— æ³•å†™å…¥æŒ‚è½½çš„å·

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la ./data

# ä¿®æ”¹æƒé™
chmod -R 777 ./data

# æˆ–ä½¿ç”¨ç”¨æˆ·æ˜ å°„ï¼ˆdocker-compose.ymlï¼‰
user: "${UID}:${GID}"
```

#### 3. ç½‘ç»œè¿æ¥é—®é¢˜

**é—®é¢˜**ï¼šå®¹å™¨æ— æ³•è®¿é—®å¤–ç½‘

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥ DNS
docker run --rm busybox nslookup google.com

# è‡ªå®šä¹‰ DNSï¼ˆdocker-compose.ymlï¼‰
dns:
  - 8.8.8.8
  - 8.8.4.4

# æˆ–ä¿®æ”¹ /etc/docker/daemon.json
{
  "dns": ["8.8.8.8", "8.8.4.4"]
}
sudo systemctl restart docker
```

#### 4. é•œåƒæ„å»ºå¤±è´¥

**é—®é¢˜**ï¼š`pip install` è¶…æ—¶

**è§£å†³**ï¼š
```dockerfile
# ä½¿ç”¨å›½å†…é•œåƒï¼ˆDockerfileï¼‰
RUN pip install --no-cache-dir \
    -i https://pypi.tuna.tsinghua.edu.cn/simple \
    -r requirements.txt
```

### ğŸ” é€šç”¨é—®é¢˜

#### 1. å†…å­˜ä¸è¶³

**é—®é¢˜**ï¼šåº”ç”¨å´©æºƒæˆ– OOM

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
# Windows
Get-Process python | Format-List

# macOS/Linux
ps aux | grep python
top -p $(pgrep python)

# å¢åŠ è™šæ‹Ÿå†…å­˜ï¼ˆWindowsï¼‰
# ç³»ç»Ÿå±æ€§ > é«˜çº§ > æ€§èƒ½ > è®¾ç½® > é«˜çº§ > è™šæ‹Ÿå†…å­˜

# å¢åŠ  swapï¼ˆLinuxï¼‰
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

#### 2. æ–‡ä»¶ä¸Šä¼ å¤±è´¥

**é—®é¢˜**ï¼šä¸Šä¼ å¤§æ–‡ä»¶å¤±è´¥

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥é…ç½®
cat .env | grep MAX_UPLOAD_SIZE

# ä¿®æ”¹é™åˆ¶
export MAX_UPLOAD_SIZE=1000  # MB

# Nginx é…ç½®ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
client_max_body_size 1000M;
```

#### 3. FFmpeg é”™è¯¯

**é—®é¢˜**ï¼šè§†é¢‘å¯¼å‡ºå¤±è´¥

**è§£å†³**ï¼š
```bash
# éªŒè¯ FFmpeg
ffmpeg -version
ffmpeg -codecs | grep h264

# æµ‹è¯•ç¼–ç 
ffmpeg -i input.mp4 -c:v libx264 -preset fast test.mp4

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/error.log
```

#### 4. ç«¯å£å†²çª

**é—®é¢˜**ï¼šç«¯å£å·²è¢«å ç”¨

**è§£å†³**ï¼š
```bash
# Windows
netstat -ano | findstr :5000
taskkill /PID <PID> /F

# macOS
lsof -ti:5000 | xargs kill -9

# Linux
sudo lsof -i :5000
sudo kill $(sudo lsof -t -i:5000)

# æˆ–ä¿®æ”¹åº”ç”¨ç«¯å£
export FLASK_PORT=5001
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—](./éƒ¨ç½²æŒ‡å—.md) - é€šç”¨éƒ¨ç½²è¯´æ˜
- [å¿«é€Ÿä¸Šæ‰‹æŒ‡å—](../user-guide/å¿«é€Ÿä¸Šæ‰‹æŒ‡å—.md) - æ–°æ‰‹å…¥é—¨
- [FAQ](../user-guide/FAQ.md) - å¸¸è§é—®é¢˜è§£ç­”
- [é›†æˆæµ‹è¯•æŒ‡å—](../testing/é›†æˆæµ‹è¯•æŒ‡å—.md) - æµ‹è¯•éƒ¨ç½²

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.2.2 (2025-10-26)

- âœ… **æ–°å¢ openEuler éƒ¨ç½²æ”¯æŒ**
- âœ… æ·»åŠ  openEuler 20.03/22.03 LTS ç¯å¢ƒå‡†å¤‡è¯´æ˜
- âœ… æ·»åŠ  openEuler ä½¿ç”¨ dnf å®‰è£… FFmpeg çš„è¯¦ç»†æ­¥éª¤
- âœ… æ·»åŠ  openEuler é˜²ç«å¢™ï¼ˆfirewalldï¼‰é…ç½®æŒ‡å—
- âœ… æ·»åŠ  openEuler SELinux é…ç½®è¯´æ˜
- âœ… å®Œå–„ Linux å‘è¡Œç‰ˆæ”¯æŒï¼ˆUbuntu/Debian/CentOS/RHEL/openEulerï¼‰

### v2.2.1 (2025-10-26)

- âœ… æ–°å¢å®Œæ•´çš„å¤šå¹³å°éƒ¨ç½²æŒ‡å—
- âœ… æ·»åŠ  Windows/macOS/Linux è¯¦ç»†è¯´æ˜
- âœ… æ·»åŠ  Docker è·¨å¹³å°éƒ¨ç½²
- âœ… æ·»åŠ å¹³å°å·®å¼‚å¯¹ç…§è¡¨
- âœ… æ·»åŠ è¯¦ç»†çš„æ•…éšœæ’æŸ¥æŒ‡å—
- âœ… æ¶µç›–æ‰€æœ‰ä¸»æµæ“ä½œç³»ç»Ÿå’Œéƒ¨ç½²æ–¹å¼

---

**æ–‡æ¡£å®Œæˆåº¦**: 100% âœ…

æœ€åæ›´æ–°ï¼š2025å¹´10æœˆ26æ—¥
