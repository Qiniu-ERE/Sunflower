# v2.0 快速测试指南

> 如何快速测试720p视频输出和字幕生成功能

---

## 🚀 快速开始

### 1. 安装依赖

```bash
cd lecture-video-composer

# 安装基础依赖
pip install -r requirements.txt

# 注意：字幕功能需要安装 Whisper（可选）
pip install openai-whisper
```

### 2. 运行测试脚本

```bash
# 运行v2.0功能测试
python examples/basic/test_v2_features.py
```

---

## 📋 测试项目说明

测试脚本包含4个测试项目：

### 测试 1: 720p视频导出 ✅ 推荐
- **耗时**: 约2-3分钟
- **测试内容**: 
  - 默认720p分辨率视频导出
  - 不包含字幕（快速测试）
  - 验证视频信息（分辨率、大小、比特率等）
- **输出**: `examples/output/v2_test/video_720p.mp4`

### 测试 2: 字幕生成 ✅ 推荐
- **耗时**: 约2-5分钟（首次运行需下载模型）
- **测试内容**:
  - 检查Whisper安装
  - 从音频生成SRT和ASS字幕
  - 显示字幕内容预览
- **输出**: 
  - `examples/output/v2_test/subtitles/*.srt`
  - `examples/output/v2_test/subtitles/*.ass`

### 测试 3: 带字幕视频 ⏱️ 可选（耗时）
- **耗时**: 约5-10分钟
- **测试内容**:
  - 生成字幕
  - 将字幕嵌入到720p视频中
- **输出**: `examples/output/v2_test/video_720p_with_subtitles.mp4`
- **注意**: 需要先安装Whisper

### 测试 4: 分辨率对比 ⏱️ 可选（耗时）
- **耗时**: 约4-6分钟
- **测试内容**:
  - 分别导出1080p和720p视频
  - 对比文件大小和质量
- **输出**:
  - `examples/output/v2_test/video_1080p.mp4`
  - `examples/output/v2_test/video_720p_compare.mp4`

---

## 💡 推荐测试流程

### 方案A: 快速验证（推荐新用户）

```bash
# 1. 只运行前两个测试（约5分钟）
python examples/basic/test_v2_features.py

# 当询问是否测试字幕视频时，输入 N
# 当询问是否对比分辨率时，输入 N
```

### 方案B: 完整测试（推荐开发者）

```bash
# 运行所有测试（约15-20分钟）
python examples/basic/test_v2_features.py

# 当询问时，都输入 y
```

### 方案C: 单独测试字幕

```bash
# 只测试字幕生成功能
python src/services/subtitle/subtitle_service.py \
    examples/fixtures/2025-10-24-15:15:15.mp3 \
    --output-dir examples/output/subtitles \
    --model base \
    --language zh
```

---

## 📁 查看测试结果

### 输出文件位置

```
examples/output/v2_test/
├── video_720p.mp4                    # 720p视频（无字幕）
├── video_720p_with_subtitles.mp4     # 720p视频（带字幕）
├── video_1080p.mp4                   # 1080p视频（对比用）
├── video_720p_compare.mp4            # 720p视频（对比用）
├── metadata.json                     # 项目元数据
├── subtitles/                        # 字幕文件
│   ├── 2025-10-24-15:15:15.srt      # SRT格式字幕
│   └── 2025-10-24-15:15:15.ass      # ASS格式字幕
├── audio/                            # 音频文件
└── photos/                           # 照片文件
```

### 播放视频

**推荐播放器**:
- **VLC Media Player** - 全平台，最佳兼容性
- **MPC-HC** - Windows平台
- **IINA** - macOS平台
- **mpv** - Linux平台

**播放命令**:
```bash
# macOS
open examples/output/v2_test/video_720p.mp4

# Windows
start examples/output/v2_test/video_720p.mp4

# Linux
xdg-open examples/output/v2_test/video_720p.mp4

# 使用VLC
vlc examples/output/v2_test/video_720p_with_subtitles.mp4
```

---

## 🔍 验证要点

### 1. 视频质量检查

- [ ] 视频能够正常播放
- [ ] 分辨率为1280x720
- [ ] 照片清晰，无失真
- [ ] 照片切换流畅
- [ ] 音频同步正确

### 2. 字幕检查

- [ ] 字幕文件正确生成（SRT和ASS）
- [ ] 字幕内容与音频匹配
- [ ] 字幕时间轴准确
- [ ] 字幕在视频中正确显示
- [ ] 字幕位置和样式合适

### 3. 性能检查

- [ ] 720p文件比1080p小约40%
- [ ] 视频质量在可接受范围内
- [ ] 处理速度在合理范围内

---

## ❓ 常见问题

### Q1: Whisper安装失败

**问题**: `pip install openai-whisper` 失败

**解决**:
```bash
# 方法1: 升级pip
pip install --upgrade pip
pip install openai-whisper

# 方法2: 使用清华源
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple openai-whisper

# 方法3: 使用conda
conda install -c conda-forge openai-whisper
```

### Q2: 首次运行很慢

**原因**: Whisper首次运行需要下载模型文件（约100MB）

**解决**: 
- 确保网络连接稳定
- 耐心等待模型下载完成
- 后续运行会使用缓存的模型，速度会快很多

### Q3: 字幕识别不准确

**原因**: 使用的模型太小或音频质量不好

**解决**:
```bash
# 使用更大的模型
python src/services/subtitle/subtitle_service.py \
    examples/fixtures/audio.mp3 \
    --model medium \
    --language zh
```

### Q4: 视频播放器不显示字幕

**原因**: 字幕已嵌入视频，但播放器可能不支持

**解决**:
- 使用VLC等标准播放器
- 检查字幕是否正确嵌入
- 查看SRT文件确认字幕内容正确

### Q5: 测试数据不存在

**问题**: 提示音频或照片文件不存在

**解决**:
```bash
# 检查测试数据
ls -la examples/fixtures/
ls -la examples/fixtures/sample-photos/

# 如果不存在，需要准备测试数据
# 音频文件命名格式: YYYY-MM-DD-HH:MM:SS.mp3
# 照片文件命名格式: YYYY-MM-DD-HH:MM:SS.jpg
```

---

## 🎯 性能基准

以10分钟演讲（10张照片）为例：

| 测试项 | 预期结果 |
|--------|---------|
| 720p视频导出 | 2-3分钟 |
| 字幕生成（base模型） | 2-5分钟 |
| 字幕嵌入 | 1-2分钟 |
| 720p文件大小 | 30-50MB |
| 1080p文件大小 | 60-80MB |
| 大小减少比例 | 35-45% |

**注意**: 实际性能取决于：
- CPU性能
- 是否使用GPU加速
- 音频时长
- 照片数量和大小

---

## 📞 获取帮助

如果遇到问题：

1. 查看详细错误信息
2. 检查日志输出
3. 参考文档:
   - [视频导出模块文档](../development/视频导出模块文档.md)
   - [字幕功能文档](../development/字幕功能文档.md)
   - [v2.0更新说明](../changelog/v2.0_更新说明.md)
4. 提交Issue到GitHub

---

## ✅ 测试清单

完成测试后，请确认：

- [ ] 成功安装所有依赖
- [ ] 720p视频能够正常导出
- [ ] 视频质量满足要求
- [ ] 字幕功能正常工作（如果需要）
- [ ] 了解如何配置和使用新功能
- [ ] 查看了相关文档

---

**祝测试顺利！** 🎉
