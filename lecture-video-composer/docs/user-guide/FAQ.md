# 常见问题解答 (FAQ)

> 用户最常遇到的问题及解决方案

---

## 📌 目录

- [安装与启动](#安装与启动)
- [文件上传](#文件上传)
- [项目创建](#项目创建)
- [播放问题](#播放问题)
- [视频导出](#视频导出)
- [性能优化](#性能优化)
- [其他问题](#其他问题)

---

## 安装与启动

### Q1: 如何安装系统？

**A:** 按照以下步骤安装：

**1. 安装 FFmpeg（视频导出必需）**

```bash
# macOS
brew install ffmpeg

# Ubuntu/Debian
sudo apt-get update
sudo apt-get install ffmpeg

# CentOS/RHEL
sudo yum install ffmpeg

# Windows
# 下载：https://ffmpeg.org/download.html
# 并将 ffmpeg.exe 添加到系统 PATH
```

**2. 安装 Python 依赖**

```bash
# 克隆项目
git clone https://github.com/Qiniu-ERE/Sunflower.git
cd Sunflower/lecture-video-composer

# 安装 Python 依赖（使用 Python 3.8+）
pip3 install -r requirements.txt
```

**3. 启动服务**

```bash
python3 run_web.py
```

**系统要求**：
- Python 3.8 或更高版本
- FFmpeg（音视频处理）
- 500MB 可用磁盘空间
- 现代浏览器（Chrome/Firefox/Safari）

---

### Q2: 启动失败，提示"端口已被占用"？

**A:** 5000 端口被其他程序占用。常见原因是 macOS 的 AirPlay Receiver 服务。

**解决方法**：

**方案 1：关闭 AirPlay Receiver（macOS 推荐）**
```
系统设置 -> 通用 -> 隔空播放与接力 -> 关闭「隔空播放接收器」
```

**方案 2：使用不同端口**
```bash
# 使用 8000 端口
python3 run_web.py --port 8000

# 访问地址变为：http://127.0.0.1:8000
```

**方案 3：查找并停止占用进程**
```bash
# macOS/Linux
lsof -i :5000
kill -9 <PID>

# Windows
netstat -ano | findstr :5000
taskkill /PID <PID> /F
```

**快速测试**：
```bash
# 测试端口是否可用
nc -zv 127.0.0.1 5000
```

---

### Q3: 浏览器无法访问 http://127.0.0.1:5000？

**A:** 可能的原因：

1. **服务未启动**：检查终端是否有错误信息
2. **防火墙阻止**：临时关闭防火墙测试
3. **浏览器缓存**：清除缓存或使用无痕模式

**检查服务状态**：
```bash
# 查看是否显示 "Running on http://127.0.0.1:5000"
```

---

## 文件上传

### Q4: 支持哪些文件格式？

**A:** 支持格式如下：

| 文件类型 | 支持格式 |
|---------|---------|
| **音频** | MP3, WAV, M4A |
| **照片** | JPG, JPEG, PNG |

**不支持**：AAC, FLAC, GIF, BMP, TIFF

---

### Q5: 文件命名必须严格按照格式吗？

**A:** 是的，必须严格按照 `YYYY-MM-DD-HH:MM:SS.扩展名` 格式。

**正确示例**：
```
✅ 2025-10-24-14:30:00.mp3
✅ 2025-10-24-14:32:15.jpg
```

**错误示例**：
```
❌ 2025-10-24-14-30-00.mp3  （时分秒应用冒号）
❌ 2025/10/24-14:30:00.mp3  （日期应用短横线）
❌ 20251024143000.mp3       （缺少分隔符）
```

**快速修复工具**：
```bash
# 使用文件创建时间批量重命名
python tools/rename_by_time.py ./文件目录/
```

---

### Q6: 文件上传进度卡在 99%？

**A:** 通常是网络波动或文件过大。

**解决方法**：
1. 刷新页面重新上传
2. 压缩大文件（音频转为 128kbps MP3）
3. 分批上传照片

**推荐文件大小**：
- 音频：< 100MB
- 照片：< 5MB/张

---

### Q7: 上传后文件列表为空？

**A:** 可能是会话过期或浏览器存储问题。

**解决步骤**：
1. 刷新页面
2. 清除浏览器缓存
3. 重新上传文件

---

## 项目创建

### Q8: 创建项目失败，提示"时间戳解析错误"？

**A:** 文件命名格式不正确。

**检查清单**：
- [ ] 文件名格式：`YYYY-MM-DD-HH:MM:SS.ext`
- [ ] 日期合法（如 10-32 是非法日期）
- [ ] 时间合法（如 25:00:00 是非法时间）
- [ ] 时间戳在合理范围内（如不早于 2000 年）

---

### Q9: 时间轴显示不正常？

**A:** 照片时间点可能有问题。

**诊断方法**：
1. 检查所有照片时间戳是否在音频时长范围内
2. 确认时间戳按时间顺序排列
3. 查看是否有重复时间戳

**示例**：
```
音频: 2025-10-24-14:30:00.mp3 (时长 15 分钟)

照片时间应在:
  14:30:00 到 14:45:00 之间

✅ 2025-10-24-14:32:00.jpg  （在范围内）
✅ 2025-10-24-14:35:00.jpg  （在范围内）
❌ 2025-10-24-14:50:00.jpg  （超出范围）
```

---

### Q10: 可以修改已创建的项目吗？

**A:** 可以，支持以下修改：

- ✅ 添加/删除照片
- ✅ 调整时间轴
- ✅ 修改项目名称
- ❌ 更换音频文件（需重新创建项目）

**操作方法**：
1. 在项目列表中点击"编辑"
2. 进行必要修改
3. 保存更改

---

## 播放问题

### Q11: 播放时照片不切换？

**A:** 可能的原因及解决方法：

**原因 1：时间轴问题**
- 检查照片时间点是否正确
- 确认时间轴已正确生成

**原因 2：浏览器兼容性**
- 使用 Chrome 或 Firefox 最新版本
- 清除浏览器缓存

**原因 3：JavaScript 错误**
- 按 F12 打开开发者工具
- 查看 Console 是否有错误信息

---

### Q12: 音频和照片不同步？

**A:** 时间轴同步问题。

**调试步骤**：
1. 暂停播放
2. 查看当前时间和显示的照片是否匹配
3. 手动跳转到各个照片时间点测试

**手动调整**：
```javascript
// 在浏览器 Console 中调试
console.log(timeline.getCurrentPhoto());
console.log(player.getCurrentTime());
```

---

### Q13: 播放时出现卡顿？

**A:** 性能问题，优化建议：

**立即改善**：
- 减少照片分辨率（1920x1080 → 1280x720）
- 关闭其他标签页和程序
- 使用硬件加速浏览器

**长期优化**：
- 升级内存（建议 8GB+）
- 使用 SSD 硬盘
- 优化照片文件大小

---

### Q14: 全屏模式无法退出？

**A:** 按 `Esc` 键或双击退出全屏。

如果无效：
1. 按 `F11` 切换浏览器全屏
2. 刷新页面
3. 重启浏览器

---

## 视频导出

### Q15: 导出视频失败，提示"FFmpeg not found"？

**A:** 系统未安装 FFmpeg 或未添加到 PATH。

**解决方法**：

**macOS**：
```bash
brew install ffmpeg
```

**Ubuntu/Debian**：
```bash
sudo apt-get update
sudo apt-get install ffmpeg
```

**CentOS/RHEL**：
```bash
sudo yum install ffmpeg
```

**Windows**：
1. 从 https://ffmpeg.org/download.html 下载
2. 解压到任意目录（如 `C:\ffmpeg`）
3. 将 `C:\ffmpeg\bin` 添加到系统 PATH
4. 重启终端/命令提示符

**验证安装**：
```bash
ffmpeg -version
```

---

### Q16: 导出视频需要多长时间？

**A:** 取决于多个因素：

**估算公式**：
```
导出时间 ≈ 视频时长 × 0.5 ~ 2 倍

示例：
15 分钟视频 → 7-30 分钟导出时间
```

**影响因素**：
- 分辨率（1080p 比 720p 慢 2 倍）
- 照片数量和大小
- CPU 性能
- 是否启用字幕

---

### Q17: 导出的视频画质模糊？

**A:** 调整导出设置：

**提高画质**：
1. 选择更高分辨率（1080p 或 4K）
2. 提高质量滑块到"高"或"最高"
3. 选择更高比特率

**注意**：画质提升会增加文件大小和导出时间

**推荐设置**：
```
分辨率: 1080p
帧率: 30fps
质量: 高
比特率: 8000 kbps
```

---

### Q18: 导出失败，提示"磁盘空间不足"？

**A:** 清理磁盘空间。

**所需空间估算**：
```
视频大小 ≈ 时长(分钟) × 分辨率系数 × 质量系数

720p, 中等质量:  ~50MB/分钟
1080p, 高质量:   ~100MB/分钟
4K, 最高质量:    ~300MB/分钟
```

**清理建议**：
1. 删除旧的导出文件
2. 清理临时文件
3. 预留 2-3 倍视频大小的空间

---

### Q19: 导出的视频没有字幕？

**A:** 需要手动启用字幕功能。

**步骤**：
1. 在项目设置中启用"生成字幕"
2. 选择语言（中文/英文）
3. 等待字幕生成完成
4. 再次导出视频

**注意**：
- 首次使用需下载 Whisper 模型（~1GB）
- 字幕生成时间约为音频时长的 0.5-1 倍

---

## 性能优化

### Q19: 如何加快处理速度？

**A:** 优化建议：

**文件优化**：
```bash
# 压缩照片
mogrify -resize 1920x1080 -quality 85 *.jpg

# 压缩音频
ffmpeg -i input.mp3 -b:a 128k output.mp3
```

**系统优化**：
- 关闭不必要的后台程序
- 增加 Python 进程优先级
- 使用 SSD 存储项目文件

**代码优化**：
```python
# 在 config.py 中调整
MAX_WORKERS = 4  # 根据 CPU 核心数调整
CACHE_SIZE = 100  # 增加缓存
```

---

### Q20: 可以处理多长时间的演讲？

**A:** 理论上没有限制，实际建议：

| 时长 | 照片数 | 处理时间 | 内存占用 |
|------|--------|---------|---------|
| 30 分钟 | 10-20 | 1-2 分钟 | ~500MB |
| 1 小时 | 20-40 | 2-5 分钟 | ~1GB |
| 2 小时 | 40-80 | 5-15 分钟 | ~2GB |
| 3+ 小时 | 80+ | 建议分段 | ~4GB+ |

**超长演讲建议**：
- 分段处理（每段 1-2 小时）
- 后期合并视频
- 使用更高性能的机器

---

## 其他问题

### Q21: 数据存储在哪里？

**A:** 数据目录结构：

```
lecture-video-composer/data/
├── uploads/        # 上传的原始文件
├── projects/       # 项目配置和元数据
└── exports/        # 导出的视频文件
```

**备份建议**：
- 定期备份 `data/projects/` 目录
- 导出后可删除 `uploads/` 中的原始文件
- 建议使用云存储同步重要项目

---

### Q22: 支持批量处理吗？

**A:** 目前支持有限的批量操作。

**当前支持**：
- ✅ 批量上传照片
- ✅ 批量选择文件
- ⏳ 批量导出（开发中）

**变通方法**：
```bash
# 使用 API 批量处理
for project in projects/*.json; do
    curl -X POST http://localhost:5000/api/export \
         -d @$project
done
```

---

### Q23: 可以在服务器上运行吗？

**A:** 可以，但需要额外配置。

**配置步骤**：

1. **修改监听地址**：
```python
# run_web.py
app.run(host='0.0.0.0', port=5000)
```

2. **配置防火墙**：
```bash
# 开放 5000 端口
sudo ufw allow 5000
```

3. **使用反向代理**（推荐）：
```nginx
# Nginx 配置
location / {
    proxy_pass http://localhost:5000;
}
```

**安全提示**：
- 启用 HTTPS
- 添加访问认证
- 定期更新系统

---

### Q24: 如何报告 Bug 或提建议？

**A:** 我们欢迎任何反馈！

**报告 Bug**：
1. 访问 [GitHub Issues](https://github.com/Qiniu-ERE/Sunflower/issues)
2. 点击"New Issue"
3. 选择"Bug Report"模板
4. 填写详细信息：
   - 问题描述
   - 复现步骤
   - 系统环境
   - 错误截图

**功能建议**：
1. 选择"Feature Request"模板
2.
